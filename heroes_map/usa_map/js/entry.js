		window.cdnPath="http://media.blizzard.com/heroes/images/battlegrounds/maps/blackhearts-bay/main/";
		window.battlegroundJson = {"slug":"blackhearts-bay","title":"Blackheart’s Bay","description":"The ghost pirate Blackheart has staked his claim upon the realm of Mistharbor. His raucous undead pirate crew has poured onto the streets, claiming the once thriving marketplace as their new den of vice and villainy.","map":{"tilesets":[{"slug":"main","title":"Main","tileset":"{z}/{x}/{y}.jpg"}],"center":{"lat":-46.619263,"lng":0.4394},"minZoom":0,"maxZoom":6,"initialZoom":4,"maxBounds":{"northEast":{"lat":84.0,"lng":-180.0},"southWest":{"lat":-81.0,"lng":180.0}},"crs":"crs","markers":[{"markerId":"blackheart","position":{"lat":-29.267233,"lng":0.0},"tilesetSlug":"main","content":{"title":"Blackheart","body":"Turn in your doubloons to Blackheart. Once you\u0027ve satisfied his greed, Blackheart will turn his guns on your enemies and open fire. Mwuahaha!","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/blackheartturnin.jpg","video":"tGNIkkHtcvY"},"typeSlug":"legendary","templateSlug":"text-video"},{"markerId":"chest-1","position":{"lat":2.6357887,"lng":0.0},"tilesetSlug":"main","content":{"title":"Treasure Chest","body":"Blackheart will periodically spawn treasure chests. Destroy those chests for doubloons, but beware: the other team is bound to show up to take the treasure for themselves.","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/chests.jpg","video":"XVsUHBL3Xx0"},"minZoomLevel":2,"typeSlug":"legendary","templateSlug":"text-video"},{"markerId":"chest-2","position":{"lat":-49.21042,"lng":0.0},"tilesetSlug":"main","content":{"title":"Treasure Chest","body":"Blackheart will periodically spawn treasure chests. Destroy those chests for doubloons, but beware: the other team is bound to show up to take the treasure for themselves.","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/chests.jpg","video":"XVsUHBL3Xx0"},"minZoomLevel":2,"typeSlug":"legendary","templateSlug":"text-video"},{"markerId":"siege-giants-1","position":{"lat":-46.679596,"lng":-71.98242},"tilesetSlug":"main","content":{"title":"Giants","body":"If you defeat and capture a mercenary camp, the mercenaries will fight for you until they meet their eventual demise. Make them count!","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/siegegiants.jpg","video":"XyjOfKmq29c"},"typeSlug":"mercenary","templateSlug":"text-video"},{"markerId":"knight-camp-1","position":{"lat":-69.71811,"lng":0.0},"tilesetSlug":"main","content":{"title":"Knights","body":"If you defeat and capture a mercenary camp, the mercenaries will fight for you until they meet their eventual demise. Make them count!","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/knights.jpg","video":"6M9hSA4pTQY"},"typeSlug":"mercenary","templateSlug":"text-video"},{"markerId":"golem","position":{"lat":67.67609,"lng":0.0},"tilesetSlug":"main","content":{"title":"Grave Golem","body":"If you defeat and capture a mercenary camp, the mercenaries will fight for you until they meet their eventual demise. Make them count!","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/golem.jpg","video":"OWiHFen0QZo"},"typeSlug":"mercenary","templateSlug":"text-video"},{"markerId":"knight-camp-2","position":{"lat":25.482952,"lng":-63.54492},"tilesetSlug":"main","content":{"title":"Knights","body":"If you defeat and capture a mercenary camp, the mercenaries will fight for you until they meet their eventual demise. Make them count!","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/knights.jpg","video":"6M9hSA4pTQY"},"typeSlug":"mercenary","templateSlug":"text-video"},{"markerId":"siege-giants-2","position":{"lat":-46.679596,"lng":72.59766},"tilesetSlug":"main","content":{"title":"Giants","body":"If you defeat and capture a mercenary camp, the mercenaries will fight for you until they meet their eventual demise. Make them count!","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/siegegiants.jpg","video":"XyjOfKmq29c"},"typeSlug":"mercenary","templateSlug":"text-video"},{"markerId":"knight-camp-3","position":{"lat":25.482952,"lng":63.808594},"tilesetSlug":"main","content":{"title":"Knights","body":"If you defeat and capture a mercenary camp, the mercenaries will fight for you until they meet their eventual demise. Make them count!","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/knights.jpg","video":"6M9hSA4pTQY"},"typeSlug":"mercenary","templateSlug":"text-video"},{"markerId":"skeletons-1","position":{"lat":-32.472694,"lng":-55.458984},"tilesetSlug":"main","content":{"title":"Skeletons","body":"Looks like some of Blackheart’s crew have taken some unscheduled shore leave. Send them howling back to Davy Jones’ locker and collect their doubloons.","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/mercskeletonpirates.jpg","video":"RDR6aipAT5k"},"minZoomLevel":2,"typeSlug":"mercenary","templateSlug":"text-video"},{"markerId":"skeletons-2","position":{"lat":38.548164,"lng":-30.9375},"tilesetSlug":"main","content":{"title":"Skeletons","body":"Looks like some of Blackheart’s crew have taken some unscheduled shore leave. Send them howling back to Davy Jones’ locker and collect their doubloons.","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/mercskeletonpirates.jpg","video":"RDR6aipAT5k"},"minZoomLevel":2,"typeSlug":"mercenary","templateSlug":"text-video"},{"markerId":"skeletons-3","position":{"lat":38.548164,"lng":32.25586},"tilesetSlug":"main","content":{"title":"Skeletons","body":"Looks like some of Blackheart’s crew have taken some unscheduled shore leave. Send them howling back to Davy Jones’ locker and collect their doubloons.","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/mercskeletonpirates.jpg","video":"RDR6aipAT5k"},"minZoomLevel":2,"typeSlug":"mercenary","templateSlug":"text-video"},{"markerId":"skeletons-4","position":{"lat":-32.472694,"lng":55.458984},"tilesetSlug":"main","content":{"title":"Skeletons","body":"Looks like some of Blackheart’s crew have taken some unscheduled shore leave. Send them howling back to Davy Jones’ locker and collect their doubloons.","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/mercskeletonpirates.jpg","video":"RDR6aipAT5k"},"minZoomLevel":2,"typeSlug":"mercenary","templateSlug":"text-video"},{"markerId":"blue-core","position":{"lat":-23.079731,"lng":-119.00391},"tilesetSlug":"main","content":{"title":"Core","body":"If a team’s core is destroyed, they lose. The cores can defend themselves for a while, but don’t just let the other team lay waste to your home base. Keep your core alive at all costs!","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/core-blue.jpg","video":"b-HYrUqyvhM"},"typeSlug":"structure","templateSlug":"text-video"},{"markerId":"red-core","position":{"lat":-23.079731,"lng":119.00391},"tilesetSlug":"main","content":{"title":"Core","body":"If a team’s core is destroyed, they lose. The cores can defend themselves for a while, but don’t just let the other team lay waste to your home base. Keep your core alive at all costs!","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/core-red.jpg","video":"b-HYrUqyvhM"},"typeSlug":"structure","templateSlug":"text-video"},{"markerId":"watchtower","position":{"lat":39.027718,"lng":0.0},"tilesetSlug":"main","content":{"title":"Watch Tower","body":"Whichever team captures and holds the watch tower can see through the fog of war surrounding the tower, a strategic advantage not to be missed.","image":"/heroes/static/images/battlegrounds/blackhearts-bay/video-thumbnails/watchtower.jpg","video":"qqNAdaZ8Txs"},"typeSlug":"structure","templateSlug":"text-video"}]},"objectives":[{"slug":"collect","name":"Collect Doubloons","description":"Attack treasure chests, mercenaries, and skeletons to collect doubloons."},{"slug":"turn-in","name":"Turn in Doubloons","description":"Hand your doubloons over to Blackheart or you will drop them all when you die!"},{"slug":"bombard","name":"Bombard Your Enemies","description":"After receiving enough doubloons from your team, Blackheart will bombard your enemy\u0027s forts!"}]};
			window.initialLoc = {
				lat: -46.6494,
				lng: 0.3955,
				zoom: 4,
				layer: "main"
			};


require([
	"jquery",
	"battlegrounds/interactive-map",
	"battlegrounds/edit",
	"battlegrounds/intro",
	"battlegrounds/toolbar",
	"battlegrounds/router",
	"main"
], function(
	$,
	Battleground,
	BattlegroundsEditor,
	BattlegroundIntro,
	BattlegroundToolbar,
	BattlegroundRouter,
	modal
) {

	var $editButton = $("#edit-button");
	var editor = {};
	var init = function(data) {
		if (window.initialLoc != null) {
			data.map.initialZoom = window.initialLoc.zoom;
			data.map.center.lat = window.initialLoc.lat;
			data.map.center.lng = window.initialLoc.lng;
			data.map.initialTileset = window.initialLoc.layer;

			if ( window.initialLoc.marker != null ) {
				data.openPopup = encodeURI(window.initialLoc.marker);
			}
		}

		// Set CDN path
		data.map.cdnPath = window.cdnPath;

		var map = Battleground(data);

		$(".marker-filter").on("click", function(e){
			map.filterMarkers($(this).data("type"));
		});

		modal.init({
			$modalElem: $("#modal"),
			modalTrigger: ".modal-container"
		});

		// Setup the intro
		var intro = BattlegroundIntro(map);
		var toolbar = BattlegroundToolbar({
			map: map,
			$el: $(".battleground-toolbar"),
			$zoomBtnIn: $(".zoom-control__in"),
			$zoomBtnOut: $(".zoom-control__out"),
			touch: window.Modernizr.touch
		});

		map.on("click", function() {
			toolbar.clearMenus();
		});

		map.on("popupclose popupopen", function(e) {
			$("body").toggleClass("battleground-popupopen");
		});

		// Bind analytics to popup when it opens.
		map.on("popupopen", function(e) {
			var $target = $(e.target._container).find(".modal-container");
			$target.on("click", function (e) {
				window.Core.trackEvent("heroes - Video Click", $target.attr("data-action"), $target.attr("data-label"));
			});
		});

		// Remove the intro if the user clicks on the triangle glow below "Explore the Battleground".
		$(".triangle-down").on("mousedown touchstart", function(e) {
			e.preventDefault();
			intro.toggleIntro();
		});

		// Show the intro when the "i" icon is clicked in the toolbar.
		toolbar.on("introClick", function(e) {
			e.preventDefault();
			toolbar.clearMenus();
			intro.toggleIntro();
		});

		// Update the markers when the filters change in the toolbar.
		toolbar.on("filterChange", function(e) {
			var $target = $(e.currentTarget);
			map.filterMarkers($target.data("option"));
			$target.toggleClass("is-active");
		});

		toolbar.on("tileChange", function(e) {
			var $target = $(e.currentTarget);
			map.changeLayers($target.data("option"));
			$(".toolbar__tile-control__button.is-active").removeClass("is-active");
			$target.toggleClass("is-active");
		});

		toolbar.on("zoomInClick", function(e) {
			map.zoom(1);
		});

		toolbar.on("zoomOutClick", function(e) {
			map.zoom(-1);
		});

		// Initialize the router
		var router = BattlegroundRouter({
			map: map,
			useHistory: Modernizr.history,
			openPopup: data.openPopup,
			layer: data.map.initialTileset
		});

		// Dirty Hack to get the nav and explore menu to work on older versions of webkit
		// 534.30 is the Webkit version used by stock Android browsers from 4.0.1 to 4.3
		var webkitVersion = /AppleWebKit\/([\d.]+)/.exec(navigator.userAgent);
		if (webkitVersion) {
			if (parseFloat(webkitVersion[1]) <= 534.30) {
				$(".interactive-map").addClass("old-webkit");
			}
		}
	};

	//var staticUrl = window.Core.staticUrl != "" ? window.Core.staticUrl : "/heroes/static";

	init(window.battlegroundJson);

});
